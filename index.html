<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>aniiidroid · retro desktop (v6)</title>
<style>
  :root{
    /* Head placement on page (percent of page) */
    --player-x: 21;   /* left %  */
    --player-y: 14;   /* top  %  */
    --player-w: 40.6; /* width % (30% smaller than original 58) */

    /* Video window inside the head (percent of head box) */
    --screen-left: 37.0;
    --screen-top:  28.0;
    --screen-w:    27.0;
    --screen-h:    30.0;

    /* AOL window placement */
    --aol-x: 73;  --aol-y: 54;  --aol-w: 22;

    /* Background fit */
    --bgfit: contain;

    /* Z layering */
    --z-icons: 2;      /* desktop icons */
    --z-popups: 6;     /* windows / art */
    --z-cursor: 9999;  /* custom cursor */
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:#061607;
    color:#000;
    font-family:Tahoma,Verdana,system-ui,sans-serif;
    cursor:none; /* custom cursor */
    overflow:hidden;
  }

  /* Full-viewport stage + background */
  .stage{
    position:fixed; inset:0; width:100vw; height:100dvh;
    background:url('98webbgfin.png') center/var(--bgfit) no-repeat;
    overflow:hidden;
    touch-action:none; /* keep drags smooth on touch */
  }

  /* Head (draggable) */
  .player{
    position:absolute;
    left:calc(var(--player-x) * 1%); top:calc(var(--player-y) * 1%);
    width:calc(var(--player-w) * 1%);
    user-select:none; -webkit-user-drag:none;
    cursor:grab; touch-action:none; display:none; /* hidden until opened */
    z-index:var(--z-popups);
  }
  .player.show{ display:block; }
  .player:active{ cursor:grabbing; }
  .player .sprite{
    position:relative; z-index:2;
    width:100%; height:auto; display:block; image-rendering:pixelated;
    pointer-events:none; /* pass clicks to iframe where transparent */
  }
  .player .screen{ position:absolute; z-index:1; left:calc(var(--screen-left) * 1%); top:calc(var(--screen-top) * 1%); width:calc(var(--screen-w) * 1%); height:calc(var(--screen-h) * 1%); background:#000; overflow:hidden; }
  .player .screen iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }

  /* AOL window (draggable) */
  .aol{ position:absolute; left:calc(var(--aol-x) * 1%); top:calc(var(--aol-y) * 1%); width:calc(var(--aol-w) * 1%); user-select:none; -webkit-user-drag:none; cursor:grab; touch-action:none; z-index:var(--z-popups); display:none; }
  .aol.show{ display:block; }
  .aol:active{ cursor:grabbing; }
  .aol .sprite{ width:100%; height:auto; display:block; image-rendering:pixelated; pointer-events:none }

  /* MP3 window (bottom) */
  .mp3{ position:absolute; left:50%; transform:translateX(-50%); bottom:2%; z-index:var(--z-popups); display:none; cursor:grab; user-select:none; }
  .mp3.show{ display:block; }
  .mp3 img{ width:min(56vw, 504px); height:auto; display:block; image-rendering:pixelated; pointer-events:none }

  /* SoundCloud container that pops UNDER the mp3 window and follows it */
  .sc-wrap{ display:none; position:fixed; pointer-events:auto; }
  .sc-wrap iframe{ width:100%; border:0 }

  /* Desktop icons (middle, behind windows) */
  .icons{ position:absolute; left:50%; top:52%; transform:translate(-50%,-50%); display:grid; grid-template-columns:repeat(4, 110px); grid-auto-rows: 120px; gap:14px; z-index:var(--z-icons) }
  .icon{ width:108px; height:110px; display:grid; place-items:center; cursor:pointer; background:transparent; border:0; padding:0; appearance:none; -webkit-appearance:none; }
  .icon:focus{ outline:2px solid rgba(0,255,122,.6); outline-offset:2px }
  .icon img{ max-width:100%; max-height:100%; image-rendering:pixelated; pointer-events:none; filter:none }

  /* Recycle icon: positioning now handled by JS so it tracks the icon grid on resize. */
  #iconRecycle{ position:fixed; z-index:var(--z-icons); transition:transform .08s ease; }
  #iconRecycle.hot{ transform:scale(1.08); filter:drop-shadow(0 0 8px rgba(0,255,122,.7)); }

  /* Draggable helpers for anything that pops */
  .pop{ position:absolute; z-index:var(--z-popups); touch-action:none; }
  .dragging{ cursor:grabbing !important }

  /* Custom cursor */
  #cursor{ position:fixed; left:0; top:0; height:32px; width:auto; pointer-events:none; transform:translate(-50%,-50%); image-rendering:pixelated; z-index:var(--z-cursor); }
  #cursor.down{ filter:invert(1) hue-rotate(180deg) }
</style>
</head>
<body>

<main class="stage" id="stage" aria-label="retro desktop background">
  <!-- Head / player -->
  <div class="player pop" id="player" data-sink="hide" data-miny="-25" data-minx="-12">
    <img src="media head.png" alt="media head" class="sprite" draggable="false"/>
    <div class="screen" aria-label="video screen">
      <!-- PLAYLIST EMBED (keeps same size/position and resizes with the head) -->
      <iframe id="yt"
        src="https://www.youtube.com/embed/videoseries?list=PLu5_M7wgzi0PtRH4YW5YN74MMQfqM6_g9&rel=0&modestbranding=1&playsinline=1"
        title="YouTube playlist"
        allow="autoplay; accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
    </div>
  </div>

  <!-- AOL window -->
  <div class="aol pop" id="aol" data-sink="hide" data-miny="-15" data-minx="-10">
    <img src="aoll3.png" alt="About window" class="sprite" draggable="false"/>
  </div>

  <!-- MP3 player (bottom) + SoundCloud under it -->
  <div class="mp3 pop" id="mp3Win" data-sink="hide" data-miny="-25" data-minx="-12">
    <img src="music player.png" alt="music player" draggable="false"/>
  </div>
  <div class="sc-wrap" id="scWrap">
    <!-- Using your playlist URL so it's playable on-page -->
    <iframe
      height="450" scrolling="no" frameborder="no" allow="autoplay"
      src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/aniiidroid/sets/droid&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
    <div style="font-size: 10px; color: #cccccc;line-break: anywhere;word-break: normal;overflow: hidden;white-space: nowrap;text-overflow: ellipsis; font-family: Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight: 100;"><a href="https://soundcloud.com/aniiidroid" title="ANIIIDROID" target="_blank" style="color: #cccccc; text-decoration: none;">ANIIIDROID</a> · <a href="https://soundcloud.com/aniiidroid/sets/droid" title="Droid" target="_blank" style="color: #cccccc; text-decoration: none;">Droid</a></div>
  </div>

  <!-- Desktop icons (middle, behind windows) -->
  <nav class="icons" aria-label="desktop icons">
    <button class="icon" id="iconVid" title="Video"><img src="vid icon.png" alt="video icon"></button>
    <button class="icon" id="iconAol" title="AOL"><img src="aol icon.png" alt="aol icon"></button>
    <button class="icon" id="iconMp3" title="MP3"><img src="mp3 icon.png" alt="mp3 icon"></button>
    <button class="icon" id="iconArt" title="Art"><img src="art icon.png" alt="art icon"></button>
    <button class="icon" id="iconAbout" title="About Me"><img src="about me.png" alt="about me icon"></button>
    <button class="icon" id="iconVirus" title="Virus"><img src="virus icon.png" alt="virus icon"></button>
    <button class="icon" id="iconRecycle" title="Recycle"><img src="recycling.png" alt="recycling"></button>
  </nav>
</main>

<!-- Cursor & click sound -->
<img id="cursor" src="mouse 3.gif" alt=""
     onerror="document.body.style.cursor='auto'; this.remove();"/>
<audio id="clickAudio" src="laser.mp3" preload="metadata"></audio>

<script>
  // Elements
  const stage  = document.getElementById('stage');
  const player = document.getElementById('player');
  const aol    = document.getElementById('aol');
  const mp3Win = document.getElementById('mp3Win');
  const scWrap = document.getElementById('scWrap');
  const cursor = document.getElementById('cursor');
  const clickEl= document.getElementById('clickAudio');
  const recycleIcon = document.getElementById('iconRecycle');
  const iconsGrid = document.querySelector('.icons');

  const yt = document.getElementById('yt');
  const YT_PLAYLIST = 'https://www.youtube.com/embed/videoseries?list=PLu5_M7wgzi0PtRH4YW5YN74MMQfqM6_g9&rel=0&modestbranding=1&playsinline=1';

  const stageRect = () => stage.getBoundingClientRect();
  const setVar = (el,n,v)=> el.style.setProperty(n, String(v));

  // CLICK SOUND (on any press)
  function clickFx(){ try{ clickEl.currentTime = 0; clickEl.play(); }catch(_){ } }
  window.addEventListener('pointerdown', ()=>{ cursor?.classList.add('down'); clickFx(); });
  window.addEventListener('pointerup',   ()=>{ cursor?.classList.remove('down'); });

  // CUSTOM CURSOR FOLLOW
  function cursorMove(e){ const p = e.touches?.[0] || e; if(!cursor || !p) return; cursor.style.left = p.clientX + 'px'; cursor.style.top  = p.clientY + 'px'; }
  window.addEventListener('pointermove', cursorMove, {passive:true});
  window.addEventListener('touchmove',   cursorMove, {passive:true});
  setTimeout(()=>{ if(cursor && !cursor.style.left){ document.body.style.cursor='auto'; try{cursor.remove();}catch(_){}} }, 1200);

  // Helpers
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function pctX(px){ const S = stageRect(); return (px - S.left) / S.width * 100; }
  function pctY(py){ const S = stageRect(); return (py - S.top)  / S.height * 100; }
  function overlaps(a,b){ const r1=a.getBoundingClientRect(), r2=b.getBoundingClientRect(); return !(r1.right<r2.left||r1.left>r2.right||r1.bottom<r2.top||r1.top>r2.bottom); }

  // >>> EDIT HERE: distance from the icon grid to the recycle can (px)
  const RECYCLE_OFFSET = { dx: 240, dy: 160 };

  function positionRecycle(){
    const r = iconsGrid.getBoundingClientRect();
    let x = r.right + RECYCLE_OFFSET.dx;
    let y = r.bottom + RECYCLE_OFFSET.dy;
    // keep on screen with 16px margin
    const el = recycleIcon; el.style.position='fixed';
    const w = el.getBoundingClientRect().width || 64; const h = el.getBoundingClientRect().height || 64;
    x = clamp(x, 16, window.innerWidth - w - 16);
    y = clamp(y, 16, window.innerHeight - h - 16);
    el.style.left = x + 'px';
    el.style.top  = y + 'px';
  }
  window.addEventListener('resize', positionRecycle);
  window.addEventListener('load', positionRecycle);

  // Generic draggable for any .pop element (supports slight overflow past LEFT/TOP)
  function makeDraggable(el, opts={}){
    let dragging=false, dx=0, dy=0; el.style.left = el.style.left || '10%'; el.style.top = el.style.top || '10%';
    const minYpct = parseFloat(el.dataset.miny ?? opts.miny ?? '0');
    const minXpct = parseFloat(el.dataset.minx ?? opts.minx ?? '0');
    function down(e){ dragging=true; el.classList.add('dragging'); try{ el.setPointerCapture?.(e.pointerId);}catch(_){} const r=el.getBoundingClientRect(); const p=e.touches?.[0]||e; dx=p.clientX-r.left; dy=p.clientY-r.top; }
    function move(e){ if(!dragging) return; const p=e.touches?.[0]||e; const S=stageRect(); let x=pctX(p.clientX-dx+S.left); let y=pctY(p.clientY-dy+S.top); const ew=el.getBoundingClientRect().width/S.width*100; x=clamp(x,minXpct,100-ew); y=clamp(y,minYpct,100-10); el.style.left=x+'%'; el.style.top=y+'%'; if(el===mp3Win) positionScUnderMp3();
      // highlight recycle only, do NOT delete until release
      if(overlaps(el, recycleIcon)) recycleIcon.classList.add('hot'); else recycleIcon.classList.remove('hot');
    }
    function up(){ if(!dragging) return; dragging=false; el.classList.remove('dragging');
      const shouldTrash = overlaps(el, recycleIcon);
      recycleIcon.classList.remove('hot');
      if(shouldTrash) handleTrash(el);
    }
    el.addEventListener('pointerdown', down); el.addEventListener('touchstart', down, {passive:true});
    window.addEventListener('pointermove', move, {passive:true}); window.addEventListener('touchmove', move, {passive:true});
    window.addEventListener('pointerup', up); window.addEventListener('touchend', up);
  }

  // Make built-in windows draggable
  makeDraggable(player); makeDraggable(aol); makeDraggable(mp3Win);

  // Trash handler
  function handleTrash(el){
    if(el.dataset && el.dataset.sink === 'hide'){
      el.classList.remove('show');
      if(el===player){ try{ yt.src = YT_PLAYLIST; }catch(_){ } }
      if(el===mp3Win){ scWrap.style.display='none'; }
      return;
    }
    try{ el.remove(); }catch(_){ }
  }

  // ICON actions
  const $ = (id)=>document.getElementById(id);
  function bind(id, ev, fn){ const el=$(id); if(!el){ console.warn('missing', id); return;} el.addEventListener(ev, fn); }
  bind('iconVid','click', ()=>{ if(yt && yt.src!==YT_PLAYLIST) yt.src = YT_PLAYLIST; player.classList.add('show'); });
  bind('iconAol','click', ()=> aol.classList.add('show'));
  bind('iconMp3','click', ()=>{ mp3Win.classList.add('show'); positionScUnderMp3(); });
  bind('iconArt','click', spawnArt);
  bind('iconVirus','click', ()=>{ window.location.href = 'virus.html'; });
  bind('iconRecycle','click', closeAll);
  bind('iconAbout','click', ()=>{ window.location.href = 'about.html'; });

  function closeAll(){
    player.classList.remove('show'); aol.classList.remove('show'); mp3Win.classList.remove('show');
    document.querySelectorAll('.art-pop').forEach(n=>n.remove());
    scWrap.style.display = 'none'; recycleIcon.classList.remove('hot');
  }

  // SoundCloud under-the-png positioning (and width sync) — NEVER behind
  function positionScUnderMp3(){
    scWrap.style.display = 'block';
    const r = mp3Win.getBoundingClientRect();
    scWrap.style.left = (r.left + r.width/2) + 'px';
    scWrap.style.top  = (r.bottom + 8) + 'px';
    scWrap.style.transform = 'translateX(-50%)';
    const z = parseInt(getComputedStyle(mp3Win).zIndex || 10, 10);
    scWrap.style.zIndex = (z + 1).toString();
    scWrap.style.width = r.width + 'px';
  }
  window.addEventListener('resize', ()=>{ if(mp3Win.classList.contains('show')) positionScUnderMp3(); });

  // Spawn draggable art images (spread out; avoid bottom-right / recycle zone)
  const ART_FILES = ['blue2.png','trump.png','me2.png','23.png','3 yel.png'];
  let artSpawned = false;
  function spawnArt(){
    if(artSpawned) return; artSpawned = true;
    const positions = generateSpreadPositions(ART_FILES.length);
    ART_FILES.forEach((name, i)=>{
      const img = document.createElement('img'); img.src = name; img.alt = name; img.className='pop art-pop';
      img.style.left = positions[i].x + '%'; img.style.top = positions[i].y + '%';
      img.style.maxWidth = '32vw'; img.style.maxHeight = '34vh'; img.style.imageRendering='pixelated';
      img.dataset.miny = '-15'; img.dataset.minx = '-10';
      stage.appendChild(img); makeDraggable(img);
    });
    // Reset flag when all are gone so you can re-open
    const observer = new MutationObserver(()=>{
      if(!document.querySelector('.art-pop')){ artSpawned=false; observer.disconnect(); }
    });
    observer.observe(stage, {childList:true});
  }

  function generateSpreadPositions(n){
    // Avoid bottom-right 30%x30% area to reduce accidental deletes
    const forbidden = {x:70, y:70};
    const pts = []; const minDist = 14; // percent distance
    let tries = 0;
    while(pts.length < n && tries < 500){
      tries++;
      const x = 10 + Math.random()*60; // keep away from far edges
      const y = 12 + Math.random()*44; // upper/mid area
      if(x>forbidden.x && y>forbidden.y) continue; // avoid bottom-right
      if(pts.every(p=>Math.hypot(p.x-x, p.y-y) > minDist)) pts.push({x:Math.round(x*100)/100, y:Math.round(y*100)/100});
    }
    // Fallback grid if random placement failed
    while(pts.length<n){ pts.push({x: 12 + pts.length*16, y: 16 + (pts.length%2)*18}); }
    return pts;
  }

  // Initial layout calls
  positionRecycle();
</script>
</body>
</html>
